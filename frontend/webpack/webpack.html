<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | è‡ªç•™åœ°</title>
    <meta name="description" content="æ„å»ºè‡ªå·±çš„å‰ç«¯çŸ¥è¯†ä½“ç³»ï¼Œå­¦å­¦å…¶ä»–æ„Ÿå…´è¶£çš„ä¸œè¥¿">
    
    
    <link rel="preload" href="/assets/css/0.styles.25475262.css" as="style"><link rel="preload" href="/assets/js/app.c4ee8238.js" as="script"><link rel="preload" href="/assets/js/2.d33ca5e5.js" as="script"><link rel="preload" href="/assets/js/25.0b81cce6.js" as="script"><link rel="prefetch" href="/assets/js/10.64571db3.js"><link rel="prefetch" href="/assets/js/11.d20305c0.js"><link rel="prefetch" href="/assets/js/12.900d3086.js"><link rel="prefetch" href="/assets/js/13.13f44de6.js"><link rel="prefetch" href="/assets/js/14.ec775242.js"><link rel="prefetch" href="/assets/js/15.3fc2ac06.js"><link rel="prefetch" href="/assets/js/16.c6de990f.js"><link rel="prefetch" href="/assets/js/17.d35e877e.js"><link rel="prefetch" href="/assets/js/18.ad60cb0d.js"><link rel="prefetch" href="/assets/js/19.145d146e.js"><link rel="prefetch" href="/assets/js/20.cdd0c263.js"><link rel="prefetch" href="/assets/js/21.75814d08.js"><link rel="prefetch" href="/assets/js/22.5c4ad18f.js"><link rel="prefetch" href="/assets/js/23.936b0ea2.js"><link rel="prefetch" href="/assets/js/24.04ad7624.js"><link rel="prefetch" href="/assets/js/26.74da315b.js"><link rel="prefetch" href="/assets/js/27.884f44d0.js"><link rel="prefetch" href="/assets/js/28.f28c0f63.js"><link rel="prefetch" href="/assets/js/29.8c79d59b.js"><link rel="prefetch" href="/assets/js/3.4cd9d029.js"><link rel="prefetch" href="/assets/js/30.f6d2a313.js"><link rel="prefetch" href="/assets/js/31.ba3d42c9.js"><link rel="prefetch" href="/assets/js/32.d8087f75.js"><link rel="prefetch" href="/assets/js/33.a91b1565.js"><link rel="prefetch" href="/assets/js/34.8d69ccdc.js"><link rel="prefetch" href="/assets/js/35.0215d3d4.js"><link rel="prefetch" href="/assets/js/36.9f469f71.js"><link rel="prefetch" href="/assets/js/4.abed38d4.js"><link rel="prefetch" href="/assets/js/5.cd784ab4.js"><link rel="prefetch" href="/assets/js/6.e5fe4998.js"><link rel="prefetch" href="/assets/js/7.cf376b6b.js"><link rel="prefetch" href="/assets/js/8.6c3e2080.js"><link rel="prefetch" href="/assets/js/9.e77df01f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.25475262.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">è‡ªç•™åœ°</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/frontend/" class="nav-link router-link-active">å‰ç«¯çŸ¥è¯†ä½“ç³»</a></div><div class="nav-item"><a href="/guide/" class="nav-link">è®¡ç®—æœºåŸºç¡€</a></div><div class="nav-item"><a href="/read/" class="nav-link">è¯»ä¹¦</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/frontend/" class="nav-link router-link-active">å‰ç«¯çŸ¥è¯†ä½“ç³»</a></div><div class="nav-item"><a href="/guide/" class="nav-link">è®¡ç®—æœºåŸºç¡€</a></div><div class="nav-item"><a href="/read/" class="nav-link">è¯»ä¹¦</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æ¦‚è¦</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/" class="sidebar-link">å‰ç«¯é¦–é¡µ</a></li><li><a href="/frontend/summary/method.html" class="sidebar-link">å­¦ä¹ æ–¹æ³•</a></li><li><a href="/frontend/summary/thinking.html" class="sidebar-link">thinking</a></li><li><a href="/frontend/summary/resource.html" class="sidebar-link">å­¦ä¹ èµ„æº</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>åŸºç¡€çŸ¥è¯†</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/base/protoType.html" class="sidebar-link">åŸå‹å’ŒåŸå‹é“¾</a></li><li><a href="/frontend/base/scope.html" class="sidebar-link">ä½œç”¨åŸŸ</a></li><li><a href="/frontend/base/executionContext.html" class="sidebar-link">æ‰§è¡Œä¸Šä¸‹æ–‡</a></li><li><a href="/frontend/base/variableObject.html" class="sidebar-link">å˜é‡å¯¹è±¡</a></li><li><a href="/frontend/base/this.html" class="sidebar-link">this</a></li><li><a href="/frontend/base/closure.html" class="sidebar-link">é—­åŒ…</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ES6</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/es6/promise.html" class="sidebar-link">promise</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>æ¡†æ¶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/fig-show.html" class="sidebar-link">Dva å›¾è§£</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/webpack/webpack.html" class="active sidebar-link">Webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/webpack/webpack.html#webpack" class="sidebar-link">Webpack</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Babel</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/babel/babel.html" class="sidebar-link">Babel</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å…¶ä»–</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/else/module.html" class="sidebar-link">æ¨¡å—</a></li><li><a href="/frontend/else/performance.html" class="sidebar-link">/frontend/else/performance.html</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h2> <h3 id="tabable"><a href="#tabable" class="header-anchor">#</a> Tabable</h3> <p>####åŸºæœ¬ç”¨æ³•ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
    SyncHook
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../lib/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> sh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A:'</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span>
    before<span class="token punctuation">:</span> <span class="token string">'A'</span>  <span class="token comment">// å½±å“è¯¥å›è°ƒçš„æ‰§è¡Œé¡ºåº, å›è°ƒBæ¯”å›è°ƒAå…ˆæ‰§è¡Œ</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'B:'</span><span class="token punctuation">,</span> arg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// callçš„æ—¶å€™ä¼ çš„æ˜¯å‚æ•°argï¼Œä¸éœ€è¦keyã€‚</span>
<span class="token function">sh</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'Tapable'</span><span class="token punctuation">)</span>

<span class="token comment">// output:</span>
<span class="token constant">B</span><span class="token punctuation">:</span>Tapable
<span class="token constant">A</span><span class="token punctuation">:</span>Tapable
</code></pre></div><p>![image-20200604095421208](/Users/ouliang/Library/Application Support/typora-user-images/image-20200604095421208.png)</p> <p>è¯´æ˜ï¼š</p> <ul><li><p><code>Basic hook</code>ï¼šæŒ‰ç…§äº‹ä»¶æ³¨å†Œé¡ºåºï¼Œä¾æ¬¡æ‰§è¡Œ<code>handler</code>ï¼Œ<code>handler</code>ä¹‹é—´äº’ä¸å¹²æ‰°ï¼›</p></li> <li><p><code>Bail hook</code>ï¼šæŒ‰ç…§äº‹ä»¶æ³¨å†Œé¡ºåºï¼Œä¾æ¬¡æ‰§è¡Œ<code>handler</code>ï¼Œè‹¥å…¶ä¸­ä»»ä¸€<code>handler</code>è¿”å›å€¼ä¸ä¸º<code>undefined</code>ï¼Œåˆ™å‰©ä½™çš„<code>handler</code>å‡ä¸ä¼šæ‰§è¡Œï¼›</p></li> <li><p><code>Waterfall hook</code>ï¼šæŒ‰ç…§äº‹ä»¶æ³¨å†Œé¡ºåºï¼Œä¾æ¬¡æ‰§è¡Œ<code>handler</code>ï¼Œå‰ä¸€ä¸ª<code>handler</code>çš„è¿”å›å€¼å°†ä½œä¸ºä¸‹ä¸€ä¸ª<code>handler</code>çš„å…¥å‚ï¼›</p></li> <li><p>Loop hook<code>ï¼šæŒ‰ç…§äº‹ä»¶æ³¨å†Œé¡ºåºï¼Œä¾æ¬¡æ‰§è¡Œ</code>handler<code>ï¼Œè‹¥ä»»ä¸€</code>handler<code>çš„è¿”å›å€¼ä¸ä¸º</code>undefined<code>ï¼Œåˆ™è¯¥äº‹ä»¶é“¾å†æ¬¡**ä»å¤´**å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°æ‰€æœ‰</code>handler<code>å‡è¿”å›</code>undefined</p></li></ul> <p>####åŸºæœ¬åŸç†</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> sh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ç”Ÿæˆä¸‹é¢çš„å¯¹è±¡</span>
Tapable <span class="token operator">=</span> <span class="token punctuation">{</span>
  taps<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function-variable function">tap</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">call</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// å°†cbæ”¾å…¥åˆ°Tabableå¯¹è±¡çš„tapsæ•°ç»„ä¸­ï¼Œå¹¶æ¸…ç©ºä¹‹å‰ç”Ÿæˆcallçš„æ–¹æ³•,taps = [cbA, cbB]</span>
sh<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">cbA</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A:'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">cbB</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è°ƒç”¨callï¼Œé€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç”Ÿæˆä¸€ä¸ªå‡½æ•°ï¼ˆæƒ°æ€§å‡½æ•°çš„æŠ€å·§ï¼‰ã€‚</span>
<span class="token function">sh</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'Tapable'</span><span class="token punctuation">)</span>
<span class="token comment">// ç”Ÿæˆå‡½æ•°å¦‚ä¸‹, sh.call('Tapable') ç›¸å½“äºanonymous('Tapable')</span>
<span class="token keyword">function</span> <span class="token function">anonymous</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> _context<span class="token punctuation">;</span>
    <span class="token keyword">var</span> _x <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_x<span class="token punctuation">;</span>
    <span class="token keyword">var</span> _fn0 <span class="token operator">=</span> _x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">_fn0</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> _fn1 <span class="token operator">=</span> _x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">_fn1</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="æ’ä»¶"><a href="#æ’ä»¶" class="header-anchor">#</a> æ’ä»¶</h4> <p>EntryPluginæ’ä»¶å¦‚ä¸‹</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">EntryPlugin</span> <span class="token punctuation">{</span>
	<span class="token comment">/**
	 * An entry plugin which will handle
	 * creation of the EntryDependency
	 *
	 * @param {string} context context path
	 * @param {string} entry entry path
	 * @param {string} name entry key name
	 */</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> entry<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>entry <span class="token operator">=</span> entry<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param {Compiler} compiler the compiler instance
	 * @returns {void}
	 */</span>
	<span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>
			<span class="token string">&quot;EntryPlugin&quot;</span><span class="token punctuation">,</span>
			<span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> <span class="token punctuation">{</span> normalModuleFactory <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				compilation<span class="token punctuation">.</span>dependencyFactories<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
					EntryDependency<span class="token punctuation">,</span>
					normalModuleFactory
				<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// compiler.hooks.makeå°±æ˜¯ä¸€ä¸ªTabableå¯¹è±¡ï¼Œè¿™é‡Œè®¢é˜…ä¸€ä¸ªäº‹ä»¶ï¼Œ&quot;EntryPlugin&quot;å€¼å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨</span>
		compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&quot;EntryPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">const</span> <span class="token punctuation">{</span> entry<span class="token punctuation">,</span> name<span class="token punctuation">,</span> context <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> dep <span class="token operator">=</span> EntryPlugin<span class="token punctuation">.</span><span class="token function">createDependency</span><span class="token punctuation">(</span>entry<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
			compilation<span class="token punctuation">.</span><span class="token function">addEntry</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> dep<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * @param {string} entry entry request
	 * @param {string} name entry name
	 * @returns {EntryDependency} the dependency
	 */</span>
	<span class="token keyword">static</span> <span class="token function">createDependency</span><span class="token punctuation">(</span><span class="token parameter">entry<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EntryDependency</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
		dep<span class="token punctuation">.</span>loc <span class="token operator">=</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> dep<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><a href="https://juejin.im/post/5dcba29f6fb9a04abb01fd77#heading-1" target="_blank" rel="noopener noreferrer">ç¼–å†™è‡ªå®šä¹‰webpackæ’ä»¶ä»ç†è§£Tapableå¼€å§‹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="webpackåŸºæœ¬åŸç†"><a href="#webpackåŸºæœ¬åŸç†" class="header-anchor">#</a> WebpackåŸºæœ¬åŸç†</h3> <p><strong>Compiler</strong>  vs  <strong>Compilation</strong></p> <p>compilerä»£è¡¨çš„æ˜¯ä¸å˜çš„webpackç¯å¢ƒï¼Œ æ˜¯ä¸€æ¬¡webpackå¯åŠ¨åˆ°ç»“æŸè¿‡ç¨‹ä¸­ä¸å˜çš„ä¸œè¥¿ã€‚è­¬å¦‚ï¼š åˆå§‹åŒ–webpacké…ç½®ï¼Œplguinæ’ä»¶ã€‚</p> <p>compilationä»£è¡¨çš„æ˜¯ä¸€æ¬¡ç¼–è¯‘ä½œä¸šï¼Œæ¯ä¸€æ¬¡çš„ç¼–è¯‘éƒ½å¯èƒ½ä¸åŒ</p> <p><strong>æ¦‚è¿°ï¼š</strong></p> <ol><li>è°ƒç”¨<code>webpack</code>å‡½æ•°æ¥æ”¶<code>config</code>é…ç½®ä¿¡æ¯ï¼Œå¹¶åˆå§‹åŒ–<code>compiler</code>ï¼Œåœ¨æ­¤æœŸé—´ä¼š<code>apply</code>æ‰€æœ‰ webpack å†…ç½®çš„æ’ä»¶å’Œç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶;</li> <li>è°ƒç”¨<code>compiler.run</code>è¿›å…¥æ¨¡å—ç¼–è¯‘é˜¶æ®µï¼›</li> <li>æ¯ä¸€æ¬¡æ–°çš„ç¼–è¯‘éƒ½ä¼šå®ä¾‹åŒ–ä¸€ä¸ª<code>compilation</code>å¯¹è±¡ï¼Œè®°å½•æœ¬æ¬¡ç¼–è¯‘çš„åŸºæœ¬ä¿¡æ¯ï¼›</li> <li>è¿›å…¥<code>make</code>é˜¶æ®µï¼Œå³è§¦å‘<code>compilation.hooks.make</code>é’©å­ï¼Œä»<code>entry</code>ä¸ºå…¥å£ï¼š a. è°ƒç”¨åˆé€‚çš„<code>loader</code>å¯¹æ¨¡å—æºç é¢„å¤„ç†ï¼Œè½¬æ¢ä¸ºæ ‡å‡†çš„JSæ¨¡å—ï¼› b. è°ƒç”¨ç¬¬ä¸‰æ–¹æ’ä»¶<code>acorn</code>å¯¹æ ‡å‡†JSæ¨¡å—è¿›è¡Œåˆ†æï¼Œæ”¶é›†æ¨¡å—ä¾èµ–é¡¹ã€‚åŒæ—¶ä¹Ÿä¼šç»§ç»­é€’å½’æ¯ä¸ªä¾èµ–é¡¹ï¼Œæ”¶é›†ä¾èµ–é¡¹çš„ä¾èµ–é¡¹ä¿¡æ¯ï¼Œä¸æ–­é€’å½’ä¸‹å»ï¼›æœ€ç»ˆä¼šå¾—åˆ°ä¸€é¢—ä¾èµ–æ ‘ğŸŒ²ï¼›</li> <li>æœ€åè°ƒç”¨<code>compilation.seal</code> render æ¨¡å—ï¼Œæ•´åˆå„ä¸ªä¾èµ–é¡¹ï¼Œæœ€åè¾“å‡ºä¸€ä¸ªæˆ–å¤šä¸ªchunkï¼›</li></ol> <p><strong>è¯¦ç»†ï¼š</strong></p> <ol><li><p>ç”±Compilerç±»å®ä¾‹åŒ–compilerï¼Œ æŒ‚è½½æ’ä»¶åˆ°compilerä¸Šï¼Œç­‰å¾…ç¼–è¯‘æ—¶è§¦å‘ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">createCompiler</span> <span class="token operator">=</span> <span class="token parameter">options</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  	<span class="token comment">// newæ—¶ï¼Œåœ¨compiler.hooksä¸ŠæŒ‚è½½äº†å¾ˆå¤šEventEmitå®ä¾‹ï¼Œè­¬å¦‚compiler.hooks.compilationå°±æ˜¯ä¸€ä¸ª</span>
  	<span class="token comment">// äº‹ä»¶å®ä¾‹ï¼Œ .tapæ—¶è®¢é˜…äº‹ä»¶ï¼Œ .callæ—¶è§¦å‘äº‹ä»¶ã€‚</span>
    <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
    <span class="token comment">// æ³¨å†Œç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶, æ‰§è¡Œæ’ä»¶çš„applyæ–¹æ³•ï¼š</span>
    <span class="token comment">// compiler.hooks.compilation.tap(&quot;ModuleInfoHeaderPlugin&quot;, () =&gt; {})</span>
    <span class="token comment">// æå‰æ³¨å†Œäº‹ä»¶ç›‘å¬ï¼Œç­‰å¾…ç¼–è¯‘æ—¶è§¦å‘äº‹ä»¶ã€‚</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterEnvironment</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  	<span class="token comment">// processä¸­æ³¨å†Œæ‰€æœ‰webpackå†…ç½®çš„æ’ä»¶ï¼Œå¹¶åˆå§‹åŒ–ä¸€äº›options</span>
    <span class="token comment">// processå‡½æ•°æ‰§è¡Œå®Œï¼Œwebpackå°†æ‰€æœ‰å®ƒå…³å¿ƒçš„hookæ¶ˆæ¯éƒ½æ³¨å†Œå®Œæˆï¼Œç­‰å¾…åç»­ç¼–è¯‘è¿‡ç¨‹ä¸­æŒ¨ä¸ªè§¦å‘ã€‚</span>
    compiler<span class="token punctuation">.</span>options <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebpackOptionsApply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> compiler<span class="token punctuation">)</span> 
    <span class="token keyword">return</span> compiler
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>compiler.run()</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// æ‰€æœ‰é’©å­éƒ½æ˜¯ç”±`Tapable`æä¾›çš„ï¼Œä¸åŒé’©å­ç±»å‹åœ¨è§¦å‘æ—¶ï¼Œè°ƒç”¨æ—¶åºä¹Ÿä¸åŒ</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
            beforeRun<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compiler&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            run<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compiler&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            done<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;stats&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token comment">//...</span>
    <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token function-variable function">onCompiled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>stats<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> stats<span class="token punctuation">)</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterDone</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// beforeRun --&gt; run --&gt; done --&gt; afterDone</span>
        <span class="token comment">// runå‡½æ•°é’©ä½äº†webpackç¼–è¯‘çš„å‰æœŸå’ŒåæœŸçš„é˜¶æ®µï¼Œ</span>
        <span class="token comment">// é‚£ä¹ˆä¸­æœŸæœ€ä¸ºå…³é”®çš„ä»£ç ç¼–è¯‘è¿‡ç¨‹å°±äº¤ç»™äº†this.compile()æ¥å®Œæˆäº†</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeRun<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>run<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>onCompiled<span class="token punctuation">)</span> <span class="token comment">// onCompiled = callback</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>compiler.compile()</code></p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">newCompilationParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// åˆå§‹åŒ–æ¨¡å—å·¥å‚å¯¹è±¡</span>
    <span class="token comment">// beforeCompile --&gt; compile --&gt; make --&gt; afterCompile</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>beforeCompile<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        <span class="token comment">// compilationè®°å½•æœ¬æ¬¡ç¼–è¯‘ä½œä¸šçš„ç¯å¢ƒä¿¡æ¯ </span>
        <span class="token keyword">const</span> compilation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compilation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token comment">// makeå°±æ˜¯æˆ‘ä»¬å…³å¿ƒçš„ç¼–è¯‘è¿‡ç¨‹</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>make<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>compilation<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            compilation<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                compilation<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>afterCompile<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span>compilation<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> compilation<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><ol start="4"><li><p>ç¼–è¯‘çš„è¿‡ç¨‹ï¼šåŠ è½½å…¥å£æ–‡ä»¶ï¼Œè°ƒç”¨loaderå°†å…¥å£æ–‡ä»¶çš„æ‰€æœ‰ä¾èµ–è½¬æ¢æˆjsæ¨¡å—ï¼Œç„¶åè½¬æ¢æˆASTæ ‘ï¼Œæ‰¾å‡ºæ‰€æœ‰ä¾èµ–ï¼Œ å†å°†ASTè½¬æ¢æˆcodeã€‚è¿™ä¸ªè¿‡ç¨‹å°±å®Œæˆä¸€ä¸ªå…¥å£æ–‡ä»¶çš„å®Œæ•´ç¼–è¯‘è¿‡ç¨‹ï¼šç”¨loaderè½¬æ¢æˆjsæ¨¡å—ï¼Œæ‰¾åˆ°æ‰€æœ‰ä¾èµ–ï¼Œç”Ÿæˆcodeã€‚  ç„¶åå°±æ˜¯é€’å½’ä¾èµ–é¡¹ï¼Œé‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç”Ÿæˆä¾èµ–å…³ç³»å›¾ã€‚æœ€åé‡å†™requireå‡½æ•°ç”Ÿæˆbundleã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ä¾èµ–å›¾</span>
<span class="token punctuation">{</span>  
  <span class="token string">'./src/index.js'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    dependecies<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token string">'./hello.js'</span><span class="token punctuation">:</span> <span class="token string">'./src/hello.js'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>    code<span class="token punctuation">:</span> <span class="token string">'&quot;use strict&quot;;\n\nvar _hello = require(&quot;./hello.js&quot;);\n\ndocument.write((0, _hello.say)(&quot;webpack&quot;));'</span>  	<span class="token punctuation">}</span><span class="token punctuation">,</span>  
<span class="token string">'./src/hello.js'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>    dependecies<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>    code<span class="token punctuation">:</span>      <span class="token string">'&quot;use strict&quot;;\n\nObject.defineProperty(exports, &quot;__esModule&quot;, {\n  value: true\n});\nexports.say = say;\n\nfunction say(name) {\n  return &quot;hello &quot;.concat(name);\n}'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ol> <h3 id="ä¸€äº›æ¦‚å¿µ"><a href="#ä¸€äº›æ¦‚å¿µ" class="header-anchor">#</a> ä¸€äº›æ¦‚å¿µ</h3> <h4 id="hash-vs-chunkhash-vs-contenthash"><a href="#hash-vs-chunkhash-vs-contenthash" class="header-anchor">#</a> hash vs chunkHash vs contentHash</h4> <p><strong>Hash:</strong> æ¯æ¬¡æ„å»ºç”Ÿæˆæ‰€æœ‰çš„æ–‡ä»¶åç¼€hashå€¼éƒ½ä¸€æ ·ã€‚ä»»ä¸€æ–‡ä»¶å†…å®¹æ”¹å˜ï¼Œæ‰€æœ‰æ–‡ä»¶çš„hashå€¼éƒ½æ”¹å˜ï¼›æ²¡æ”¹åŠ¨åˆ™æ¯æ¬¡æ„å»ºhashå€¼ä¸å˜ã€‚ä¸€èˆ¬ä¸ç”¨ã€‚</p> <p><strong>chunkHashï¼š</strong> æ ¹æ®å…¥å£çš„ä¸åŒç”Ÿæˆä¸åŒçš„hashçš„chunkã€‚å¯ç”¨äºå°†åŸºç¡€åŒ…å’Œä¸šåŠ¡ä»£ç åˆ†åˆ«å¢åŠ å…¥å£ï¼Œç„¶åæ‰“æˆä¸åŒchunkçš„åŒ…ï¼Œå½“ä¸šåŠ¡ä»£ç å˜åŠ¨æ—¶ï¼Œä¸ä¼šå½±å“åˆ°åŸºç¡€åŒ…çš„hashå€¼ã€‚</p> <p>ä½†ç¼ºç‚¹æ˜¯jsæ–‡ä»¶å¼•ç”¨cssæ—¶ï¼Œå³ä½¿åˆ†ç¦»å‡ºcssæ–‡ä»¶ï¼Œä»–ä»¬ä¹Ÿæ˜¯å…¬ç”¨ä¸€ä¸ªhashã€‚æ‰€ä»¥å¦‚æœjsæ–‡ä»¶æ”¹åŠ¨è€Œcssæ–‡ä»¶æœªæ”¹åŠ¨çš„è¯ï¼Œcssçš„hashå€¼ä¾ç„¶ä¼šå˜ã€‚</p> <p><strong>contentHashï¼š</strong> ä¸€èˆ¬cssæ–‡ä»¶ä½¿ç”¨contentHashï¼Œè¿™æ ·jsæ–‡ä»¶æ”¹åŠ¨æ—¶ï¼Œcssæ–‡ä»¶æœªæ”¹åŠ¨ï¼Œåˆ™cssæ–‡ä»¶çš„hashä¸ä¼šæ›´æ”¹ã€‚ä½†æ˜¯è‹¥cssæ–‡ä»¶æ”¹åŠ¨ï¼Œè€Œjsæ–‡ä»¶æœªæ”¹åŠ¨æ—¶ï¼Œä¸¤è€…çš„hashå‡ä¼šæ”¹åŠ¨ã€‚è§£å†³åŠæ³•åº”è¯¥æ˜¯æŠ½å‡ºruntimeï¼Ÿï¼ˆå­˜ç–‘ï¼‰</p> <p><strong>dll</strong></p> <p>ç›¸å½“äºæ‰“åŒ…çš„ç¼“å­˜ï¼Œwebpack4å·²ç»ä¸éœ€è¦ä½¿ç”¨äº†ï¼Œæå‡é€Ÿåº¦å¾ˆå°‘ï¼Œå¯ä½¿ç”¨<a href="https://github.com/mzgoddard/hard-source-webpack-plugin" target="_blank" rel="noopener noreferrer">HardSourceWebpackPlugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œ webpack5ä¹Ÿå†…ç½®äº†HardSourceWebpackPluginã€‚</p> <p><strong>webpack ä¸­ï¼Œmoduleï¼Œchunk å’Œ bundle çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p> <p>æˆ‘ä»¬ç›´æ¥å†™å‡ºæ¥çš„æ˜¯ moduleï¼Œwebpack å¤„ç†æ—¶æ˜¯ chunkï¼Œæœ€åç”Ÿæˆæµè§ˆå™¨å¯ä»¥ç›´æ¥è¿è¡Œçš„ bundleã€‚</p> <p><strong>filename å’Œ chunkFilename çš„åŒºåˆ«</strong></p> <p><code>filename</code> æŒ‡<strong>åˆ—åœ¨</strong> <code>entry</code> ä¸­ï¼Œæ‰“åŒ…åè¾“å‡ºçš„æ–‡ä»¶çš„åç§°ã€‚</p> <p><code>chunkFilename</code> æŒ‡<strong>æœªåˆ—åœ¨</strong> <code>entry</code> ä¸­ï¼Œå´åˆéœ€è¦è¢«æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶çš„åç§°ã€‚</p> <p><strong>webpackPrefetchã€webpackPreload å’Œ webpackChunkName åˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</strong></p> <p><code>webpackChunkName</code> æ˜¯ä¸ºé¢„åŠ è½½çš„æ–‡ä»¶å–åˆ«åï¼Œ<code>webpackPrefetch</code> ä¼šåœ¨æµè§ˆå™¨é—²ç½®ä¸‹è½½æ–‡ä»¶ï¼Œ<code>webpackPreload</code> ä¼šåœ¨çˆ¶ chunk åŠ è½½æ—¶å¹¶è¡Œä¸‹è½½æ–‡ä»¶ã€‚</p> <p>ä¼˜åŒ–Webpack</p> <ul><li><p>ä½¿ç”¨<code>é«˜ç‰ˆæœ¬</code>çš„ Webpack å’Œ Node.js</p></li> <li><p><code>å¤šè¿›ç¨‹/å¤šå®ä¾‹æ„å»º</code>ï¼šHappyPack(ä¸ç»´æŠ¤äº†)ã€thread-loade</p></li> <li><p>å‹ç¼©ä»£ç </p></li> <li><p><code>ç¼©å°æ‰“åŒ…ä½œç”¨åŸŸ</code></p></li> <li><p>æå–é¡µé¢å…¬å…±èµ„æº</p></li> <li><p>å……åˆ†åˆ©ç”¨ç¼“å­˜æå‡äºŒæ¬¡æ„å»ºé€Ÿåº¦</p></li> <li><p>tree shaking</p></li></ul> <p>sideEffects**</p> <p>sideEffectsæ˜¯æ•´ä¸ªåŒ…çš„è§’åº¦æ¥çœ‹çš„ï¼Œå¦‚æœè¿™ä¸ªåŒ…ä¸æ˜¯åšpolyfillçš„ï¼Œå°±å¯ä»¥åŠ ä¸Š <code>sideEffects: false</code> ã€‚</p> <blockquote><p>é¡¹ç›®ä¸­ä½¿ç”¨åˆ°lessæˆ–è€…sassçš„è¯ä¸èƒ½ç›´æ¥sideEffects: falseå§ï¼Œå¥½åƒä¼šè¢«tree shakingï¼Œå¯¼è‡´mini-css-extract-pluginæ— æ³•æŠ½å–å‡ºcssæ–‡ä»¶</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å…¨å±€ CSS å‰¯ä½œç”¨è§„åˆ™ç›¸å…³çš„ Webpack é…ç½®</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
 module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/regex/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span> <span class="token punctuation">[</span>loaders<span class="token punctuation">]</span><span class="token punctuation">,</span>
    sideEffects<span class="token punctuation">:</span> <span class="token boolean">true</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>æˆ‘è¿™ä¸ªåŒ…åœ¨è®¾è®¡çš„æ—¶å€™å°±æ˜¯æœŸæœ›æ²¡æœ‰å‰¯ä½œç”¨çš„ï¼Œå³ä½¿ä»–æ‰“å®ŒåŒ…åæ˜¯æœ‰å‰¯ä½œç”¨çš„ï¼Œwebpack åŒå­¦ä½ æ‘‡æ ‘æ—¶æ”¾å¿ƒçš„å½“æˆæ— å‰¯ä½œç”¨åŒ…æ‘‡å°±å¥½å•¦ï¼</strong></p> <p><strong>Treeshaking</strong></p> <p>åŸºç¡€ï¼šå› ä¸ºES6æ¨¡å—çš„å‡ºç°ï¼ŒES6æ¨¡å—ä¾èµ–å…³ç³»æ˜¯ç¡®å®šçš„ï¼Œ<code>å’Œè¿è¡Œæ—¶çš„çŠ¶æ€æ— å…³</code>ï¼Œå¯ä»¥è¿›è¡Œå¯é çš„é™æ€åˆ†æï¼Œ</p> <p>ä¸èƒ½treeshakingçš„æƒ…å†µï¼š</p> <ul><li>å¯¹äºäº§ç”Ÿå‰¯ä½œç”¨çš„ä»£ç æ— æ³•æ¶ˆé™¤ï¼šegï¼šç±»ã€‚ç«‹å³æ‰§è¡Œå‡½æ•°ã€‚babelä¼šæŠŠç±»è½¬æ¢æˆç«‹å³æ‰§è¡Œå‡½æ•°ã€‚æ²¡æœ‰å‰¯ä½œç”¨&quot;è¿™ä¸ªçŸ­è¯­å¯ä»¥è¢«è§£é‡Šä¸º&quot;ä¸ä¸é¡¶å±‚æ¨¡å—ä»¥å¤–çš„ä¸œè¥¿è¿›è¡Œäº¤äº’</li></ul> <p>ä¼˜åŒ–æ–¹æ³•ï¼š</p> <ul><li>ç¬¬ä¸‰æ–¹åº“ï¼šå°½é‡ä½¿ç”¨æä¾›ESæ¨¡å—çš„ç‰ˆæœ¬</li> <li>babelè®¾ç½®moduleï¼š falseï¼Œä½¿ç”¨webpackçš„æ¨¡å—è§£æã€‚</li> <li>æ·»åŠ æ³¨é‡Š<code>/*#__PURE__*/</code>çš„æ–¹å¼æ¥å£°æ˜ä¸€ä¸ªæ— å‰¯ä½œç”¨çš„å‡½æ•°ï¼ˆbabelå’Œwebpackå‡å¯è¿‡æ»¤ï¼‰</li> <li>ä½¿ç”¨æ’ä»¶<a href="https://github.com/vincentdchan/webpack-deep-scope-analysis-plugin" target="_blank" rel="noopener noreferrer">webpack-deep-scope-analysis-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>sideEffects?</p> <p>å¯¹äºäº§ç”Ÿå‰¯ä½œç”¨çš„ä»£ç æ— æ³•æ¶ˆé™¤ï¼šegï¼šç±»ã€‚ç«‹å³æ‰§è¡Œå‡½æ•°</p> <p>ä½¿ç”¨æ’ä»¶<a href="https://github.com/vincentdchan/webpack-deep-scope-analysis-plugin" target="_blank" rel="noopener noreferrer">webpack-deep-scope-analysis-plugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>ä½¿ç”¨ES2015(ES6)çš„æ¨¡å—</li> <li>é¿å…ä½¿ç”¨IIFE</li> <li>å¦‚æœä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æ¨¡å—ï¼Œå¯ä»¥å°è¯•ç›´æ¥ä»æ–‡ä»¶è·¯å¾„å¼•ç”¨çš„æ–¹å¼ä½¿ç”¨</li></ul> <p>Uglifyä¸åšç¨‹åºæµçš„åˆ†æï¼Œä½†æ˜¯rollupåšäº†</p> <p>å˜é‡çš„èµ‹å€¼å¯èƒ½ä¼šå¼•èµ·å‰¯ä½œç”¨</p> <p>å¯ä»¥å°è¯•æ·»åŠ æ³¨é‡Š<code>/*#__PURE__*/</code>çš„æ–¹å¼æ¥å£°æ˜ä¸€ä¸ªæ— å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œä½¿å¾—Webpackåœ¨åˆ†æå¤„ç†æ—¶å¯ä»¥è¿‡æ»¤æ‰è¿™éƒ¨åˆ†ä»£ç ï¼Œè¿™ä¹Ÿæ˜¯Babel<code>7</code>çš„æ‰§è¡Œè¡Œä¸º</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/19/2020, 8:01:05 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/frontend/fig-show.html" class="prev">Dva å›¾è§£</a></span> <span class="next"><a href="/frontend/babel/babel.html">Babel</a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c4ee8238.js" defer></script><script src="/assets/js/2.d33ca5e5.js" defer></script><script src="/assets/js/25.0b81cce6.js" defer></script>
  </body>
</html>
